# Kubernetes Containers – Notes (02-09-2025)

## 📌 Pod vs Containers
- **Pod** → Only **one type** in Kubernetes (smallest deployable unit).  
- **Containers** → Run **inside a Pod**, and can have different **roles/patterns**.  
- 👉 So, **containers ≠ pod types**. They are just **patterns inside a Pod**.

---

## 📌 Container Roles in a Pod

### 1. Main Container
- Runs the **main application**.  
- Example: Nginx web server.  

---

### 2. Init Container
- Runs **before the main container** starts.  
- Used only for **setup/configuration**.  
- Example: Velero tool for EKS backup.  

---

### 🔎 Note before Sidecar
- Every application produces **logs**.  
- Commonly, there are two log files:  
  - `access.log`  
  - `error.log`  
- Example in Nginx: `cd /var/log/nginx`

---

### 3. Sidecar Container
- Helps the main container by doing **supporting tasks** like logging.  
- Example: Fetching or tailing logs from Nginx (`error.log`, `access.log`).  

---

### 4. Ambassador Container
- Works as a **proxy/helper container**.  
- Not commonly used.  
- Example: Additional image configuration to connect with outside services.  

---

### 5. Ephemeral Container
- Used **only for debugging**.  
- Temporary → data is **lost** once shutdown.  
- Not important for main application flow.  

---

## 📌 Volumes in Kubernetes
- Volumes are used to **share data** between containers inside the same Pod.  
- In this sidecar example → logs are shared between `main-container` and `sidecar-container` using a volume.  

⚠️ **Note**: Before learning Kubernetes volumes, you should clearly understand the **3 types of volumes in Docker**:  
1. **Host Volume**  
2. **Anonymous Volume**  
3. **Named Volume**

---

## 📌 Sidecar Container Example (YAML)

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: sidecar-pod
spec:
  containers:
    # -------------------------
    # Main Container
    # -------------------------
    - name: main-container
      image: nginx
      volumeMounts:
        - name: nginx-logs
          mountPath: /var/log/nginx  # Path where Nginx writes logs

    # -------------------------
    # Sidecar Container
    # -------------------------
    - name: sidecar-container
      image: busybox
      command: ["/bin/sh", "-c", "tail -f /var/log/nginx/error.log"]
      volumeMounts:
        - name: nginx-logs
          mountPath: /var/log/nginx  # Same path as main container

  # -------------------------
  # Shared Volume
  # -------------------------
  volumes:
    - name: nginx-logs
      emptyDir: {}  # Temporary storage shared between containers
```

---

## 📌 Notes
- After applying this YAML, sometimes **pod goes into `CrashLoopBackOff`** → because the sidecar (`tail -f`) keeps restarting.  
- Still, you can check logs using:

```sh
kubectl logs sidecar-pod -c sidecar-container
```

👉 This shows the **logs from main container** fetched by sidecar.  

---

# 11) Sidecar-Container  

```yaml
- name: sidecar-container
  image: busybox
  command: ["/bin/sh", "-c", "tail -f /var/log/nginx/error.log"]
  volumeMounts:
    - name: nginx-logs
      mountPath: /var/log/nginx
```

---

## 🔎 Breakdown  

### 1. `name: sidecar-container`  
- Container name inside the Pod.  
- Named **sidecar-container** to differentiate it from the **main container**.  

---

### 2. `image: busybox`  
- Uses **BusyBox image**, which is a **lightweight Linux container**.  
- Best for **small commands, debugging, and quick tasks**.  

---

### 3. `command: ["/bin/sh", "-c", "tail -f /var/log/nginx/error.log"]`  
- Runs a **shell (`/bin/sh`)**.  
- Executes the command:  
  - `tail -f /var/log/nginx/error.log` → continuously reads error logs in real-time.  
- Purpose: keep showing **Nginx error logs** generated by the main container.  

---

### 4. `volumeMounts:`  
- Mounts a **shared volume** into the sidecar container.  
- Inside it:  
  - `name: nginx-logs` → shared volume name (must match with `volumes` section).  
  - `mountPath: /var/log/nginx` → directory inside the container where volume is mounted.  

👉 Because of this, sidecar container gets access to the **same log files** written by Nginx in the main container.  

---

## 📌 Final Concept  
- **Main container (Nginx)** → writes logs at `/var/log/nginx`.  
- **Sidecar container (BusyBox)** → reads those logs continuously.  
- **Volume (nginx-logs)** → acts as a **bridge** between them.  

✅ Simple ga:  
**Main container writes logs → Volume stores → Sidecar reads logs.**  

---
